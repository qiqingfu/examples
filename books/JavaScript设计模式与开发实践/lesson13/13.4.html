<!DOCTYPE html><html lang="en"><head>  <meta charset="UTF-8">  <title>Title</title></head><body><script>  /**   * 更灵活的方式，来改进上面的职责链模式，目标是让链中的各个节点可以灵活拆分和重组。   */  class Chain {    static IDENTIFIER = "nextSuccessor"    constructor(fn) {      this.fn = fn      this.successor = null    }    setNextSuccessor(successor) {      return this.successor = successor    }    passRequest() {      const ret = this.fn.apply(this, arguments)      if (ret === Chain.IDENTIFIER) {        return this.successor && this.successor.passRequest.apply(this.successor, arguments)      }      return ret    }  }  function buy500 (orderType , pay, stock) {    if (orderType === 1 && pay === true) {      return "500元定金预购, 得到 100优惠券"    } else {      return Chain.IDENTIFIER    }  }  function buy200 (orderType , pay, stock) {    if (orderType === 2 && pay === true) {      return "200元定金预购, 得到 100优惠券"    } else {      return Chain.IDENTIFIER    }  }  function buyDefault(orderType , pay, stock) {    if (stock > 0) {      return "普通购买, 无优惠券"    } else {      return "手机库存不足"    }  }  const chainOrder500 = new Chain(buy500)  const chainOrder200 = new Chain(buy200)  const chainOrderDefault = new Chain(buyDefault)  chainOrder500.setNextSuccessor(chainOrder200)  chainOrder200.setNextSuccessor(chainOrderDefault)  const ret1 = chainOrder500.passRequest(1, true, 500)  const ret2 = chainOrder500.passRequest(2, true, 500)  const ret3 = chainOrder500.passRequest(3, true, 500)  const ret4 = chainOrder500.passRequest(1, false, 0)  console.log(ret1)  console.log(ret2)  console.log(ret3)  console.log(ret4)</script></body></html>