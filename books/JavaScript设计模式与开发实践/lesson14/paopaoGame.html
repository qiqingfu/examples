<!DOCTYPE html><html lang="en"><head>  <meta charset="UTF-8">  <title>Title</title></head><body><script>  /**   * 玩家:   *  - 死亡   *  - 离队   *  - 换队   *   * 这三种操作都交给中介者来完成(调度)   */  /**   * playerDirector   *   * 实现思路:   *  1. 发布-订阅模式   *  2. 开放一些接受玩家消息的接口, 将当前玩家的反馈处理结果再反馈给其他玩家   */  const playerDirector = (function () {    const BROADCAST_TYPES = {      LEAVE: '离开游戏',      DEAD: '死亡'    }    const events = {      addPlayer: 'addPlayer',      removePlayer: 'removePlayer',      changeTeam: 'changeTeam',      deadPlayer: 'deadPlayer',      getPlayer: 'getPlayer'    }    const players = {}    let operations = {      add: {        value: events.addPlayer,        enumerable: true      },      remove: {        value: events.removePlayer,        enumerable: true      },      change: {        value: events.changeTeam,        enumerable: true      },      dead: {        value: events.deadPlayer,        enumerable: true      },      get: {        value: events.getPlayer,        enumerable: true      }    }    operations = Object.create({      /**       * 添加玩家到队伍中       * @param player       */      [events.addPlayer](player) {        const teamColor = player.teamColor        players[teamColor] = players[teamColor] || []        players[teamColor].push(player)      },      /**       * 将当前玩家从队伍中移除(离开游戏)       * @param player       * @param message       */      [events.removePlayer](player, message = BROADCAST_TYPES.LEAVE) {        const teamColor = player.teamColor        const teamPlayers = players[teamColor]        for (let i = teamPlayers.length - 1; i > 0; i--) {          if (teamPlayers[i] === player) {            teamPlayers.splice(i, 1)          } else {            teamPlayers[i].message(`${player.name}: ${message}`)          }        }      },      /**       * 玩家更换队伍       * @param player       * @param newTeamColor       */      [events.changeTeam](player, newTeamColor) {        operations[operations.remove](player, `${player.name}: 退出${player.teamColor}队伍, 加入${newTeamColor}队伍`)        player.teamColor = newTeamColor        operations[operations.add](player)      },      /**       * 玩家死亡       * 决定游戏胜负       * @param player       */      [events.deadPlayer](player) {        const teamColor = player.teamColor        const teamPlayers = players[teamColor]        const all_dead = teamPlayers.every(player => player.state = 'dead')        if (all_dead) {          for (let i = 0; i < teamPlayers.length; i++) {            teamPlayers[i].lose()          }          for (const color in players) {            if (color !== teamColor) {              const teamPlayers = teamColor[color]              for (let i = 0; i < teamPlayers.length; i++) {                teamPlayers[i].win()              }            }          }        }      },      /**       * 获取队伍列表       */      [events.getPlayer](teamColor) {        const teamPlayers = players[teamColor]        const playersName = teamPlayers.map(player => player.name)        console.log(`          ======== ${teamColor} ========          ${playersName.join(',')}          ======== ${playersName.length}人 ========        `)      }    }, operations)    const reciveMessage = function () {      const event = Array.prototype.shift.call(arguments)      operations[event].apply(this, arguments)    }    const result = {      reciveMessage    }    for (let event in operations) {      if (operations.hasOwnProperty(event)) {        result[event] = operations[event]      }    }    return result  })()</script><script>  /**   * 玩家   */  function Player(name, teamColor) {    this.name = name    this.teamColor = teamColor    this.state = 'alive'  }  Player.prototype.message = function (msg) {    console.log(msg)  }  Player.prototype.win = function () {    console.log(this.name + 'won')  }  Player.prototype.lose = function () {    console.log(this.name + 'lose')  }  const player1 = new Player('小明', 'red')  const player2 = new Player('土豆', 'red')  const player3 = new Player('法海', 'red')  const player4 = new Player('王美丽', 'red')  const player5 = new Player('山羊', 'blue')  const player6 = new Player('南哥', 'blue')  const player7 = new Player('钢炮', 'blue')  playerDirector.reciveMessage(playerDirector.add, player1)  playerDirector.reciveMessage(playerDirector.add, player2)  playerDirector.reciveMessage(playerDirector.add, player3)  playerDirector.reciveMessage(playerDirector.add, player4)  playerDirector.reciveMessage(playerDirector.add, player5)  playerDirector.reciveMessage(playerDirector.add, player6)  playerDirector.reciveMessage(playerDirector.add, player7)  playerDirector.reciveMessage(playerDirector.get, 'red')</script></body></html>