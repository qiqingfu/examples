<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
</head>
<body>
<script>

  const Event = (function () {
    const clientList = []
    let listen,
        trigger,
        remove

    listen = function (key, fn) {
      if (!clientList[key]) {
        clientList[key] = []
      }
      clientList[key].push(fn)
    }

    trigger = function () {
      const key = Array.prototype.shift.call(arguments)
      const fns = clientList[key]
      if (!fns || fns.length < 1) {
        return false
      }

      for (let i = 0; i < fns.length; i++) {
        fns[i].apply(this, arguments)
      }
    }

    remove = function (key, fn) {
      const fns = clientList[key]
      if (!fns) {
        return false
      }

      /**
       * 如果只指定 key, 则移除所有 key 对应的订阅函数
       */
      if (!fn) {
        fns && (fns.length = 0)
      } else {
        for (let l = fns.length - 1; l >= 0; l--) {

          const _fn = fns[l]
          if (fn === _fn) {
            fns.splice(l, 1)
          }
        }
      }
    }

    return {
      listen,
      trigger,
      remove
    }
  })()

  /**
   * test
   */
  Event.listen('80m', function (obj) {
    console.log(obj)
  })

  Event.listen('100m', function (obj) {
    console.log(obj)
  })

  const fn1 = function (obj) {
    console.log('fn1 =>', obj)
  }
  Event.listen('100m', fn1)

  /**
   * 取消 100m
   */
  Event.remove('100m', fn1)

  /**
   * 发布
   */
  delay(2000, function () {
    Event.trigger('80m', {
      loc: "QINGDAO",
      area: "80m",
      price: 1200000
    })
  })

  delay(4000, function () {
    Event.trigger('100m', {
      loc: "QINGDAO",
      area: "100m",
      price: 1500000
    })
  })

  function delay (time, fn) {
    setTimeout(fn, time)
  }

</script>
</body>
</html>
